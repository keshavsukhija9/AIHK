<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bengaluru House Price Predictor</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result-card {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            text-align: center;
            padding: 30px;
            border-radius: 15px;
            margin-top: 20px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .result-card.show {
            opacity: 1;
            transform: translateY(0);
        }

        .price-display {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .price-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .price-detail {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .samples-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-top: 30px;
        }

        .sample-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .sample-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #667eea;
            transition: transform 0.3s ease;
        }

        .sample-card:hover {
            transform: translateX(5px);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .info-box {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .info-box h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .price-display {
                font-size: 2rem;
            }
        }

        .feature-info {
            background: #f0f8ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .feature-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-home"></i> Bengaluru House Price Predictor</h1>
            <p>Get accurate house price predictions using advanced machine learning</p>
            <div style="margin-top: 20px;">
                <a href="/dashboard" style="background: rgba(255,255,255,0.2); color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; backdrop-filter: blur(10px); transition: all 0.3s ease;"
                   onmouseover="this.style.background='rgba(255,255,255,0.3)'"
                   onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                    <i class="fas fa-chart-line"></i> View Algorithm Comparison Dashboard
                </a>
            </div>
        </div>

        <div class="main-content">
            <!-- Prediction Form -->
            <div class="card">
                <h2><i class="fas fa-calculator"></i> Price Prediction</h2>
                <form id="predictionForm">
                    <div class="form-group">
                        <label for="total_sqft">Total Square Feet:</label>
                        <input type="number" id="total_sqft" name="total_sqft" value="1200" min="300" max="10000" required>
                    </div>

                    <div class="form-group">
                        <label for="bhk">Number of BHK:</label>
                        <select id="bhk" name="bhk" required>
                            <option value="1">1 BHK</option>
                            <option value="2" selected>2 BHK</option>
                            <option value="3">3 BHK</option>
                            <option value="4">4 BHK</option>
                            <option value="5">5+ BHK</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="bath">Number of Bathrooms:</label>
                        <select id="bath" name="bath" required>
                            <option value="1">1 Bathroom</option>
                            <option value="2" selected>2 Bathrooms</option>
                            <option value="3">3 Bathrooms</option>
                            <option value="4">4 Bathrooms</option>
                            <option value="5">5+ Bathrooms</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="balcony">Number of Balconies:</label>
                        <select id="balcony" name="balcony" required>
                            <option value="0">No Balcony</option>
                            <option value="1" selected>1 Balcony</option>
                            <option value="2">2 Balconies</option>
                            <option value="3">3 Balconies</option>
                            <option value="4">4+ Balconies</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="area_type">Area Type:</label>
                        <select id="area_type" name="area_type" required>
                            <option value="0" selected>Super built-up Area</option>
                            <option value="1">Plot Area</option>
                            <option value="2">Built-up Area</option>
                            <option value="3">Carpet Area</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="location">Location:</label>
                        <select id="location" name="location" required>
                            <option value="0" selected>Electronic City</option>
                            <option value="1">Whitefield</option>
                            <option value="2">Sarjapur Road</option>
                            <option value="3">Marathahalli</option>
                            <option value="4">BTM Layout</option>
                            <option value="5">Koramangala</option>
                            <option value="6">Indiranagar</option>
                            <option value="7">HSR Layout</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="availability">Availability:</label>
                        <select id="availability" name="availability" required>
                            <option value="0" selected>Ready To Move</option>
                            <option value="1">Under Construction</option>
                        </select>
                    </div>

                    <button type="submit" class="btn" id="predictBtn">
                        <i class="fas fa-magic"></i> Predict Price
                    </button>
                </form>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Calculating prediction...</p>
                </div>

                <div class="error" id="error"></div>

                <div class="result-card" id="result">
                    <h3><i class="fas fa-chart-line"></i> Predicted Price</h3>
                    <div class="price-display" id="priceDisplay">₹0.00 lakhs</div>
                    <div class="price-details">
                        <div class="price-detail">
                            <h4>Total Amount</h4>
                            <p id="totalAmount">₹0</p>
                        </div>
                        <div class="price-detail">
                            <h4>Price per Sq Ft</h4>
                            <p id="pricePerSqft">₹0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Model Information -->
            <div class="card">
                <h2><i class="fas fa-brain"></i> Model Information</h2>
                <div id="modelInfo">
                    <p>Loading model information...</p>
                </div>

                <div class="info-box">
                    <h4>How it works:</h4>
                    <p>Our AI model analyzes multiple factors including location, size, amenities, and market trends to predict house prices accurately. The model is trained on real Bengaluru housing data and uses advanced algorithms like Random Forest and Gradient Boosting.</p>
                </div>

                <div class="feature-info">
                    <h4>Features Analyzed:</h4>
                    <div class="feature-grid">
                        <div class="feature-item">Total Area</div>
                        <div class="feature-item">BHK Count</div>
                        <div class="feature-item">Bathrooms</div>
                        <div class="feature-item">Balconies</div>
                        <div class="feature-item">Location</div>
                        <div class="feature-item">Area Type</div>
                        <div class="feature-item">Availability</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sample Predictions -->
        <div class="samples-section">
            <h2><i class="fas fa-examples"></i> Sample Predictions</h2>
            <p>Here are some example predictions to give you an idea of house prices in different segments:</p>
            <div class="sample-grid" id="sampleGrid">
                <p>Loading sample predictions...</p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let isModelLoaded = false;

        // Load model information and sample predictions on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadModelInfo();
            loadSamplePredictions();
        });

        // Handle form submission
        document.getElementById('predictionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            makePrediction();
        });

        function loadModelInfo() {
            fetch('/model-info')
                .then(response => response.json())
                .then(data => {
                    const modelInfoDiv = document.getElementById('modelInfo');
                    if (data.error) {
                        modelInfoDiv.innerHTML = `<p class="error">Error loading model info: ${data.error}</p>`;
                    } else {
                        modelInfoDiv.innerHTML = `
                            <div class="feature-grid">
                                <div class="feature-item">
                                    <strong>Model Type</strong><br>
                                    ${data.model_type || 'Loading...'}
                                </div>
                                <div class="feature-item">
                                    <strong>Features</strong><br>
                                    ${data.total_features || 0}
                                </div>
                                <div class="feature-item">
                                    <strong>Best Model</strong><br>
                                    ${data.best_model || 'Training...'}
                                </div>
                                <div class="feature-item">
                                    <strong>Accuracy (R²)</strong><br>
                                    ${data.r2_score || 'N/A'}
                                </div>
                            </div>
                        `;
                        isModelLoaded = true;
                    }
                })
                .catch(error => {
                    document.getElementById('modelInfo').innerHTML = 
                        `<p class="error">Failed to load model information</p>`;
                });
        }

        function loadSamplePredictions() {
            fetch('/sample-prediction')
                .then(response => response.json())
                .then(data => {
                    const sampleGrid = document.getElementById('sampleGrid');
                    if (data.error) {
                        sampleGrid.innerHTML = `<p class="error">Error loading samples: ${data.error}</p>`;
                    } else {
                        sampleGrid.innerHTML = data.map(sample => `
                            <div class="sample-card">
                                <h3>${sample.description}</h3>
                                <p class="details">${sample.details}</p>
                                <div class="price-display" style="font-size: 1.5rem; margin: 10px 0;">
                                    ₹${sample.predicted_price} lakhs
                                </div>
                                <p style="color: #666; font-size: 0.9rem;">${sample.price_in_rupees}</p>
                            </div>
                        `).join('');
                    }
                })
                .catch(error => {
                    document.getElementById('sampleGrid').innerHTML = 
                        '<p class="error">Failed to load sample predictions</p>';
                });
        }

        function makePrediction() {
            if (!isModelLoaded) {
                showError('Model is still loading. Please wait...');
                return;
            }

            // Show loading state
            showLoading(true);
            hideError();
            hideResult();

            // Get form data
            const formData = new FormData(document.getElementById('predictionForm'));
            const data = {
                total_sqft: formData.get('total_sqft'),
                bath: formData.get('bath'),
                balcony: formData.get('balcony'),
                bhk: formData.get('bhk'),
                area_type: formData.get('area_type'),
                location: formData.get('location'),
                availability: formData.get('availability')
            };

            // Make prediction request
            fetch('/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                showLoading(false);
                
                if (result.success) {
                    showResult(result);
                } else {
                    showError(result.error || 'Prediction failed');
                }
            })
            .catch(error => {
                showLoading(false);
                showError('Network error: ' + error.message);
            });
        }

        function showResult(result) {
            document.getElementById('priceDisplay').textContent = `₹${result.predicted_price} lakhs`;
            document.getElementById('totalAmount').textContent = result.price_in_rupees;
            document.getElementById('pricePerSqft').textContent = `₹${result.price_per_sqft}`;
            
            const resultCard = document.getElementById('result');
            resultCard.classList.add('show');
        }

        function hideResult() {
            document.getElementById('result').classList.remove('show');
        }

        function showLoading(show) {
            const loading = document.getElementById('loading');
            const btn = document.getElementById('predictBtn');
            
            if (show) {
                loading.style.display = 'block';
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Calculating...';
            } else {
                loading.style.display = 'none';
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-magic"></i> Predict Price';
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        // Auto-update price per sqft estimate as user types
        document.getElementById('total_sqft').addEventListener('input', function() {
            const sqft = parseFloat(this.value);
            if (sqft && sqft > 0) {
                // Show a rough estimate (this is just for UI feedback)
                const roughEstimate = (sqft * 4000) / 100000; // Rough estimate at ₹4000 per sqft
                // You could show this estimate somewhere if desired
            }
        });
    </script>
</body>
</html>